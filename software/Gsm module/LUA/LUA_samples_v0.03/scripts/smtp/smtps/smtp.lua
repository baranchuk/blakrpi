printdir(1);

SERVER_TYPE_SMTP = 1
SERVER_TYPE_SMTPS = 2

SMTPS_RST_OK = 0;
SMTPS_RST_BUSY = 1;
SMTPS_RST_OVERSIZE = 2;
SMTPS_RST_DUPLICATE_FILE = 3;
SMTPS_RST_TIMEOUT = 4;
SMTPS_RST_TRANSFER_FAILED = 5;
SMTPS_RST_MEM_ERROR = 6;
SMTPS_RST_INVALID_PARAM = 7;
SMTPS_RST_NETWORK_ERROR = 8;
SMTPS_RST_EFS_ERROR = 9;
SMTPS_RST_SERVER_ERROR = 10;
SMTPS_RST_AUTH_FAIL = 11;
SMTPS_RST_USER_CANCEL = 12;
SMTPS_RST_UNKNOWN_ERROR = 255;

SMTPS_RCPT_TO = 0
SMTPS_RCPT_CC = 1
SMTPS_RCPT_BCC = 2

local error_code, result;

collectgarbage();
error_code = smtps.clean();
print("smtps.clean(), error_code = ", error_code, "\r\n");

error_code = smtps.set_server("smtp.163.com", 25, SERVER_TYPE_SMTP);
print("smtps.set_server(), error_code = ", error_code, "\r\n");

error_code = smtps.set_rcpt(SMTPS_RCPT_TO,0,"<jin.song@sim.com>");
print("smtps.set_rcpt(0,0,...), error_code = ", error_code, "\r\n");

error_code = smtps.set_rcpt(SMTPS_RCPT_CC,0,"<songjin_hello@163.com>");
print("smtps.set_rcpt(2,0,...), error_code = ", error_code, "\r\n");

error_code = smtps.set_rcpt(SMTPS_RCPT_BCC,0,"<jin.song.test@gmail.com>");
print("smtps.set_rcpt(3,0,...), error_code = ", error_code, "\r\n");

error_code = smtps.set_rcpt(SMTPS_RCPT_BCC,1,"<jin.song.share@gmail.com>");
print("smtps.set_rcpt(3,1,...), error_code = ", error_code, "\r\n");

error_code = smtps.set_auth("songjin_hello", "123456");
print("smtps.set_auth(), error_code = ", error_code, "\r\n");



error_code = smtps.set_from("<songjin_hello@163.com>");
print("smtps.set_from(), error_code = ", error_code, "\r\n");

--test gb2312 subject
local subject = string.hex2bin("C4E3BAC32CD5E2CAC7B2E2CAD4D3CABCFE");
error_code = smtps.set_subject(subject, "gb2312");
print("smtps.set_subject(), error_code = ", error_code, "\r\n");

--test gb2312 body
error_code = smtps.set_bch("gb2312");--default utf-8
print("smtps.set_bch(), error_code = ", error_code, "\r\n");

local body_content = "2920C6C0C2DB283029200A2E4F50686F6E65D3A6D3C3BFAAB7A2C8A8CDFED6B8C4CF202E0AB1BECAE9CFB5CDB3B5D8BDE9C9DCC1CB4F50686F6E65C6BDCCA8B5C4CCE5CFB5BDE1B9B9A1A2D3A6D3C3B3CCD0F2BFAAB7A2C1F7B3CCBACDB5F7CAD4BCBCC7C9A1A24F50686F6E65D3A6D3C3B3CCD0F2BFAAB7A2D6D0C9E6BCB0B5C4D6F7D2AAC4A3BFE9A1A3C8ABCAE9BDE1BACF3330B6E0B8F6BEADB5E4B0B8C0FDA3ACB2FBCAF6C1CB4F50686F6E65C6BDCCA8B5C4D4CBD0D0BBB7BEB3A1A2D3A6D3C3B3CCD0F2C4A3D0CDA1A2D3C3BBA7BDE7C3E6D3EBCDBCD0CED2FDC7E6A1A2CAFDBEDDB3D6BEC3BBAFB4E6B4A2B7BDB0B8A1A2D2C6B6AFB6E0C3BDCCE5BFF2BCDCA1A253657276696365A1A2C1AACDF8BDD3BFDAA1A2B8DFBCB6CDA8D0C5BCBCCAF5D2D4BCB0B7C3CECAD3B2BCFEB2E3C4DCC1A6B5C8C4DAC8DDA1A3D4DABDE9C9DC4F50686F6E65D5E2D2BBD5B8D0C2B5C4D2C6B6AFBFAAB7A2C6BDCCA8B5C4CDACCAB1A3ACD7F7D5DFC8DAC8EBC1CBB4F3C1BFBEADB5E4C9E8BCC6C4A3CABDA1A2B9A4B3CCCFEEC4BFBFAAB7A2BCBCC7C9B5C4BDE9C9DCA3ACCAB9B5C3B1BECAE9D4DACAB5BCCACFEEC4BFBFAAB7A2D6D0BEDFD3D0D6D8D2AAB5C4B2CEBFBCBCDBD6B5A1A3202E20B1BECAE9CACABACFD3D0D2BBB6A84A617661B1E0B3CCBBF9B4A1A3ACCFA3CDFBB4D3532E2E2E200A323031302D30372D31392031363A303020D4C4B6C12839322920C6C0C2DB283029200A2E416E64726F6964D2C6B6AFBFAAB7A2C8EBC3C5D3EBBDF8BDD7202E0AB1BECAE9B9B2B7D63136D5C2A1A3B5DA31D5C2BDE9C9DCC1CB416E64726F6964C6BDCCA8B5C4B7A2D5B9C7E9BFF6A3BBB5DA32D5C2A1ABB5DA3130D5C2CFB5CDB3B5D8BDE9C9DCC1CB416E64726F69642045636C69707365BCAFB3C9BFAAB7A2BBB7BEB3A3ACB0FCC0A8BFAAB7A2B9A4BEDFA1A2BFAAB7A2BBB7BEB3B4EEBDA8A1A25549D7E9BCFEA1A2C8CECEF1BACDBDF8B3CC2FCFDFB3CCC4A3D0CDA1A2B5A5D4AAB2E2CAD4A1A2CDF8C2E7CDA8D0C5BFAAB7A2D2D4BCB0D3B2BCFEBFAAB7A2B5C8A3BBB5DA3131D5C2A1ABB5DA3135D5C2CFEACFB8B5D8BDE9C9DCC1CB35B8F6D7DBBACFB0B8C0FDA3ACB0FCC0A8CAB5D3C3B5C4525353D4C4B6C1C6F7A1A2D3D0C8A4B5C4486F74204F72204E6F74D2C6B6AFBFCDBBA7B6CBB5C8B5C4BFAAB7A2A3ACB2A2B8F8B3F6C1CBCFEACFB8B4FAC2EBA3BBB5DA3136D5C2BDE9C9DCC1CB416E64726F6964204D61726B6574B5C4C7E9BFF6A1A32E20B1BECAE9CACABACFCBF9D3D0D3D0D6BED3DAB4D3CAC2416E64726F6964CAD6BBFAB2D9D7F7CFB5CDB3BFAAB7A2B2A2D3D0D2BBB6A84A617661B3CCD0F2C9E8BCC6BBF9B4A1B5C4C8CB2E2E2E200A3A303020D4C4B6C12839322920C6C0C2DB283029200A2E416E64726F6964D2C6B6AFBFAAB7A2C8EBC3C5D3EBBDF8BDD7202E0AB1BECAE9B9B2B7D63136D5C2A1A3B5DA31D5C2BDE9C9DCC1CB416E64726F6964C6BDCCA8B5C4B7A2D5B9C7E9BFF6A3BBB5DA32D5C2A1ABB5DA3130D5C2CFB5CDB3B5D8BDE9C9DCC1CB416E64726F69642045636C69707365BCAFB3C9BFAAB7A2BBB7BEB3A3ACB0FCC0A8BFAAB7A2B9A4BEDFA1A2BFAAB7A2BBB7BEB3B4EEBDA8A1A25549D7E9BCFEA1A2C8CECEF1BACDBDF8B3CC2FCFDFB3CCC4A3D0CDA1A2B5A5D4AAB2E2CAD4A1A2CDF8C2E7CDA8D0C5BFAAB7A2D2D4BCB0D3B2BCFEBFAAB7A2B5C8A3BBB5DA3131D5C2A1ABB5DA3135D5C2CFEACFB8B5D8BDE9C9DCC1CB35B8F6D7DBBACFB0B8C0FDA3ACB0FCC0A8CAB5D3C3B5C4525353D4C4B6C1C6F7A1A2D3D0C8A4B5C4486F74204F72204E6F74D2C6B6AFBFCDBBA7B6CBB5C8B5C4BFAAB7A2A3ACB2A2B8F8B3F6C1CBCFEACFB8B4FAC2EBA3BBB5DA3136D5C2BDE9C9DCC1CB416E64726F6964204D61726B6574B5C4C7E9BFF6A1A32E20B1BECAE9CACABACFCBF9D3D0D3D0D6BED3DAB4D3CAC2416E64726F6964CAD6BBFAB2D9D7F7CFB5CDB3BFAAB7A2B2A2D3D0D2BBB6A84A617661B3CCD0F2C9E8BCC6BBF9B4A1B5C4C8CB2E2E2E200A";
print("length of body_content=", string.len(body_content), "\r\n");
body_content = string.hex2bin(body_content);

error_code = smtps.set_body(body_content);
print("smtps.set_body(), error_code = ", error_code, "\r\n");

error_code = smtps.set_file();--clean all attachments first
print("smtps.set_file(), error_code = ", error_code, "\r\n");

error_code = smtps.set_file(1, "c:\\mao.txt");
print("smtps.set_file(1,...), error_code = ", error_code, "\r\n");

error_code = smtps.set_file(2, "c:\\baidu.png");
print("smtps.set_file(2,...), error_code = ", error_code, "\r\n");

local tmp_utf8_name = string.hex2bin("433A5CE6B58BE8AF95E99984E4BBB62E6A7067");
error_code = smtps.set_file(3, tmp_utf8_name);
print("smtps.set_file(3,...), error_code = ", error_code, "\r\n");

print("call smtps.send()...\r\n");
error_code = smtps.send();
print("smtps.send(), error_code=", error_code, "\r\n");


--[[
--this can be called in another thread to stop SMTPS sending
error_code = smtps.stop();
]]